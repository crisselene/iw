<!DOCTYPE html>
<html class="h-100" xmlns:th="http://www.thymeleaf.org">
<!-- <script src="js/pedidosEmpleado.js"></script> -->

<head>
    <th:block th:replace="fragments/head :: header" />
    <title>Restaurant.es: Pedidos</title>
    <link rel="stylesheet" href="css/pedidosEmpleado.css" />
</head>

<body class="d-flex flex-column h-100">
    <header th:replace="fragments/nav.html :: nav"></header>

    <button type="button" id="prueba1">Prueba1</button>

    <main class="flex-shrink-0">
        <div class="container">
            <h1 class="mt-5">Pedidos</h1>

        </div>

        <div class="container containerLeft contenedorpeds">
            <h2>Nuevos pedidos</h2>

            <div class="row rowNuevosPed">
                <th:block th:if=" ${ped.isEnCurso}==FALSE and ${ped.isActivo}==TRUE" th:each="ped,i: ${listaPedidos}">
                    <!-- Si el el primer elemento tiene q tener un css diferente para que queden bonitos los bordes,
                            lo mismo pasa con el ultimo elemento y los del medio-->

                    <!--esto es para llamar en javascript
                             th:attr="data-id=${ped.id}"-->
                    <div class="divCambiar elemento" th:attr="data-id=${ped.id}">

                        <div class="col" th:text="'Pedido: ' + ${ped.id} + ', Direccion: ' + ${ped.getDireccion}
                            + ', Cliente: ' + ${ped.cliente.username}">

                        </div>
                        <!-- El valor sirve para pasarlo al javaScript (aceptarPed) para saber quÃ© id tiene el pedido que quiero
                            poner en curso y el name tiene que ser el mismo de la columna de la base de datos para el campo que quiero
                            cambiar. En este caso quiero cambiar que el pedido estÃ© en curso= true-->
                        <form>
                            <!--PONER TH:VALUE Y TODO CON TH: QUE SI NO NO LO LEE!!!-->
                            <select class="oculto selectEstado" name="estado" th:attr="data-estPedId=${ped.id}">
                                <th:block th:each="est,iter: ${listaEstados}">
                                   <!--<option th:if="${iter.index} == 0" selected th:text="${cat}">opcion</option>
                                    <option th:unless="${iter.index} == 0" th:text="${cat}">opcion</option> -->
                                    <option th:value="${est}" th:text="${est}">opcion</option> <!-- th:attr="data-posEstado=${est}" -->
                                </th:block>
                              </select>

                            <button type="button" class="aceptar verde" th:value="${ped.id}">Aceptar</button>
                            <button type="button" class="rechazar rojo">Rechazar</button>
                        </form>
            
                    <button class="accordion">Listado de platos <p> ðŸ”½</p></button>
                        <div class="panel">
                            <p> </p>
                             <p th:each="linea: ${ped.platos}" th:text="${linea.plato.nombre} + ' x' + ${linea.cantidad} + 
                             ' (' + ${#numbers.formatDecimal(linea.precio, 1, 'DEFAULT', 2, 'DEFAULT')} + 'â‚¬/ud)'
                             ">Lechuga</p>
                             <p style="font-weight: bold;" th:text=" 'Total: '+${#numbers.formatDecimal(#aggregates.sum(ped.platos.![precio*cantidad]), 1, 'DEFAULT', 2, 'DEFAULT')} +' â‚¬' ">Total</p>
                        </div>
                    </div>
                </th:block>
            </div>

        </div>

        <div class="container containerRight">
            <h2>Pedidos actuales</h2>

            <div class="row pedEnCurso">
                <th:block th:if=" ${ped.isEnCurso}==true and ${ped.isActivo}==TRUE" th:each="ped,i: ${listaPedidos}">
                    <!-- Si el el primer elemento tiene q tener un css diferente para que queden bonitos los bordes,
                            lo mismo pasa con el ultimo elemento y los del medio-->

                    <div class="divCambiados elemento" th:attr="data-id=${ped.id}">
                        <div class="col" th:text="'Pedido: ' + ${ped.getId} + ', Direccion: ' + ${ped.getDireccion}
                            + ', Cliente: ' + ${ped.getCliente.username}"></div>
                        <form>
                            <select class="selectEstado" name="estado" th:attr="data-estPedId=${ped.id}">
                                <th:block th:each="est,iter: ${listaEstados}">
                                   <option th:if="${est} == ${ped.getEstadoAsString()}" selected th:value="${est}" th:text="${est}">opcion</option>
                                    <option th:unless="${est} == ${ped.getEstadoAsString()}" th:value="${est}" th:text="${est}">opcion</option> -->
                                    <!-- <option th:value="${est}" th:text="${est}">opcion</option>  --><!-- th:attr="data-posEstado=${est}" -->
                                </th:block>
                              </select>
                            <!-- <button class="modify verde" type="button" data-bs-toggle="modal"
                                data-bs-target="#modalModPed">Modificar</button> -->
                            <button class="rechazar rojo" type="button">Eliminar</button>

                            <!-------------------------- MODAL -------------------->
                            <!-- <div class="modal fade" id="modalModPed" data-bs-backdrop="static" data-bs-keyboard="false"
                                tabindex="-1" aria-labelledby="modalModPedLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="modalModPedTitle">AÃ±adir empleado</h5>
                                             El boton es la crucecita de arriba a la derecha para cerrar
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body" style="text-align: left;">
                                             IMPORTANTE
                                             Da error, pero es problema de Visual Code, el codigo si funciona, (de hecho, en el portatil no me daba error)
                                            <form id="formModPed" th:action="@{/}" onsubmit="return false;">
                                                <label for="nombrePedido" style="display: block;">NÃºmero de
                                                    pedido</label>
                                                <input type="text" id="nombrePedido" required>

                                                <label for="nombrePedido" style="display: block;">DirecciÃ³n</label>
                                                <input type="text" id="nombrePedido" required>

                                                <label for="nombrePedido" style="display: block;">Cliente</label>
                                                <input type="text" id="nombrePedido" required>

                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                        data-bs-dismiss="modal">Cerrar</button>
                                                    <button type="submit" id="anadirEmpleadoButton"
                                                        class="btn btn-primary">Guardar cambios</button>
                                                </div>

                                            </form>

                                        </div>

                                    </div>
                                </div>
                            </div> -->
                            <!------------------------ACABAMOS MODAL ------------------------->

                        </form>
                        <button class="accordion">Listado de platos <p> ðŸ”½</p></button>
                        <div class="panel">
                            <p> </p>
                             <p th:each="linea: ${ped.platos}" th:text="${linea.plato.nombre} + ' x' + ${linea.cantidad} + 
                             ' (' + ${#numbers.formatDecimal(linea.precio, 1, 'DEFAULT', 2, 'DEFAULT')} + 'â‚¬/ud)'
                             ">Lechuga</p>
                             <p style="font-weight: bold;" th:text=" 'Total: '+${#numbers.formatDecimal(#aggregates.sum(ped.platos.![precio*cantidad]), 1, 'DEFAULT', 2, 'DEFAULT')} +' â‚¬' ">Total</p>
                        </div>
                    </div>

                </th:block>
            </div>

        </div>

    </main>

    <th:block th:replace="fragments/footer.html :: footer" />
    <script th:src="@{/js/pedidosEmpleado.js}" src="js/pedidosEmpleado.js"></script>
    <!-- <script th:src="@{/js/pedidosEmpleadoPrueba.js}" src="js/pedidosEmpleadoPrueba.js"></script>
</body> -->

</html>